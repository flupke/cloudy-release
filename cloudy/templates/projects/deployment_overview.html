{% extends 'projects/base.html' %}

{% block navbar_extra %}
<div class="navbar-form">
    <a href="{% url 'projects_update_deployment' pk=deployment.pk %}" class="btn btn-default">
        <span class="glyphicon glyphicon-cog"></span> Configure
    </a>
    <a href="{% url 'projects_create_deployment' project_pk=deployment.project.pk %}?copy_from={{ deployment.pk }}" class="btn btn-default">
        <span class="glyphicon glyphicon-export"></span> Copy as new
    </a>
    <a href="{% url 'projects_delete_deployment' pk=deployment.pk %}" class="btn btn-default">
        <span class="glyphicon glyphicon-remove"></span> Delete
    </a>
</div>
{% endblock %}

{% block contents %}
<p>Configure your clients to point to the following URL:<p>
<pre>{{ poll_url }}</pre>

<h2>Nodes status</h2>
{% if deployment.nodes.count %}
<ul class="list-unstyled">
    {% for node in deployment.nodes.all %}
    <li>
        <h4>
            <a href="{% url 'projects_node_logs' pk=node.pk %}">{{ node }}</a> 
            <span class="label {{ node.status_css_class }}">{{ node.get_last_deployment_status_display }}</span>
            <a href="{% url 'projects_delete_node' pk=node.pk %}" class="btn btn-default btn-xs">
                <span class="glyphicon glyphicon-remove"></span> Delete
            </a>
        </h4>
        <div class="container-fluid">
            {% if node.last_deployment_date %}
            <div class="row">
                <div class="col-xs-1">Last deployed</div>
                <div class="col-xs-11">{{ node.last_deployment_date }}</div>
            </div>
            {% endif %}
            {% if node.last_deployed_source_url %}
            <div class="row">
                <div class="col-xs-1">Source URL</div>
                <div class="col-xs-11">{{ node.last_deployed_source_url }}</div>
            </div>
            {% endif %}
            {% if node.client_version %}
            <div class="row">
                <div class="col-xs-1">Client version</div>
                <div class="col-xs-11">{{ node.client_version }}</div>
            </div>
            {% endif %}
            {% if node.last_deployment_output %}
            <div class="row">
                <div class="col-xs-1">Output</div>
                <div class="col-xs-11">
                    <a href="#" data-toggle="collapse" data-target="#node-output-{{ node.pk }}">show output</a>
                    <pre id="node-output-{{ node.pk }}" class="collapse">{{ node.last_deployment_output }}</pre>
                </div>
            </div>
            {% endif %}
        </div>
    </li>
    {% endfor %}
</ul>
{% else %}
<p>No nodes information yet.</p>
{% endif %}

{% endblock %}
